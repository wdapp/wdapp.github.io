{"version":3,"sources":["webpack:///./node_modules/core-js/modules/es.string.sub.js","webpack:///./src/common/components/attendance/Attendance.vue?d621","webpack:///src/common/components/attendance/Attendance.vue","webpack:///./src/common/components/attendance/Attendance.vue?6906","webpack:///./src/common/components/attendance/Attendance.vue","webpack:///./src/common/components/attendance/Attendance.vue?1089"],"names":["$","createHTML","forcedStringHTMLMethod","target","proto","forced","sub","this","render","_vm","_h","$createElement","_c","_self","staticClass","on","onClosed","model","value","callback","$$v","show","expression","class","isShow","status","_v","_s","count","title","hide","handleAttendanceClick","staticRenderFns","name","mixins","data","timer","info","pid","expireTime","remainDuration","computed","methods","addEvents","hd","onStartAttendance","result","onEndAttendance","onEnd","delay","stopTimer","submitAttendance","isRepeat","onAttendanceSuccess","onAttendanceFail","update","startTimer","setInterval","clearInterval","mounted","component"],"mappings":"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","file":"js/chunk-2fd152e1.302d701e.js","sourcesContent":["'use strict';\nvar $ = require('../internals/export');\nvar createHTML = require('../internals/create-html');\nvar forcedStringHTMLMethod = require('../internals/forced-string-html-method');\n\n// `String.prototype.sub` method\n// https://tc39.github.io/ecma262/#sec-string.prototype.sub\n$({ target: 'String', proto: true, forced: forcedStringHTMLMethod('sub') }, {\n  sub: function sub() {\n    return createHTML(this, 'sub', '', '');\n  }\n});\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('van-popup',{staticClass:\"popup-wrapper\",on:{\"closed\":_vm.onClosed},model:{value:(_vm.show),callback:function ($$v) {_vm.show=$$v},expression:\"show\"}},[_c('div',{staticClass:\"attendance-wrapper\",class:{ 'attendance-wrapper--result': _vm.isShow }},[_c('span',{staticClass:\"attendance-icon\",class:_vm.status},[_vm._v(\" \"+_vm._s(_vm.count)+\" \")]),_c('div',{staticClass:\"attendance-title\"},[_vm._v(\" \"+_vm._s(_vm.title)+\" \")]),_c('div',{staticClass:\"attendance-sub\",class:{ hide: _vm.isShow }},[_vm._v(\" \"+_vm._s(_vm.sub)+\" \")]),_c('div',{staticClass:\"attendance-btn\",class:{ hide: _vm.isShow },on:{\"click\":_vm.handleAttendanceClick}},[_vm._v(\" 签到 \")])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <van-popup class=\"popup-wrapper\" v-model=\"show\" @closed=\"onClosed\">\n    <div\n      class=\"attendance-wrapper\"\n      :class=\"{ 'attendance-wrapper--result': isShow }\"\n    >\n      <span class=\"attendance-icon\" :class=\"status\">\n        {{ count }}\n      </span>\n      <div class=\"attendance-title\">\n        {{ title }}\n      </div>\n      <div class=\"attendance-sub\" :class=\"{ hide: isShow }\">\n        {{ sub }}\n      </div>\n      <div\n        class=\"attendance-btn\"\n        @click=\"handleAttendanceClick\"\n        :class=\"{ hide: isShow }\"\n      >\n        签到\n      </div>\n    </div>\n  </van-popup>\n</template>\n\n<script>\nimport HuodeScene from \"common/websdk/live\";\nimport Mixins from \"common/mixins\";\nimport { log } from \"common/utils\";\n\nexport default {\n  name: \"Attendance\",\n  mixins: [Mixins],\n  data() {\n    return {\n      show: false,\n      title: \"签到\",\n      sub: \"各位同学开始签到\",\n      status: \"\",\n      timer: 0,\n      info: {\n        pid: \"\",\n        expireTime: \"\",\n        remainDuration: 0\n      }\n    };\n  },\n  computed: {\n    count() {\n      return this.info.remainDuration + \"s\";\n    },\n    isShow() {\n      if (this.status === \"success\" || this.status === \"fail\") {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  },\n  methods: {\n    addEvents() {\n      this.hd.onStartAttendance(result => {\n        log(\"onStartAttendance\", result);\n        this.info.pid = result.pid;\n        this.info.expireTime = result.expireTime;\n        this.info.remainDuration = result.remainDuration;\n        this.show = true;\n        if (result.expireTime) {\n          this.status = \"timer\";\n          this.startTimer();\n        }\n        // 接收到签到时，如果时全屏状态，需要取消全屏\n        this.bus.$emit(\"exitFullscreen\");\n        log(\"onStartAttendance exitFullscreen\");\n      });\n      this.hd.onEndAttendance(result => {\n        log(\"onEndAttendance\", result);\n        this.show = false;\n      });\n    },\n    onEnd() {\n      this.delay(() => {\n        this.show = false;\n      }, 2000);\n    },\n    onClosed() {\n      this.stopTimer();\n      this.title = \"签到\";\n      this.sub = \"各位同学开始签到\";\n      this.status = \"\";\n      this.timer = 0;\n      this.info = {\n        pid: \"\",\n        expireTime: \"\",\n        remainDuration: 0\n      };\n    },\n    handleAttendanceClick() {\n      const pid = this.info.pid;\n      this.hd.submitAttendance(pid, datas => {\n        const result = datas.success;\n        if (result) {\n          const isRepeat = datas.data.isRepeat;\n          if (isRepeat) {\n            return;\n          }\n          this.onAttendanceSuccess();\n        } else {\n          this.onAttendanceFail();\n        }\n      });\n    },\n    onAttendanceSuccess() {\n      this.status = \"success\";\n      this.title = \"恭喜您，签到成功！\";\n      this.onEnd();\n    },\n    onAttendanceFail() {\n      this.status = \"fail\";\n      this.title = \"抱歉，签到失败！\";\n      this.onEnd();\n    },\n    update() {\n      this.info.remainDuration = this.info.remainDuration - 1;\n      if (this.info.remainDuration <= 0) {\n        this.stopTimer();\n        this.onAttendanceFail();\n      }\n    },\n    startTimer() {\n      this.stopTimer();\n      this.timer = setInterval(() => {\n        this.update();\n      }, 1000);\n    },\n    stopTimer() {\n      clearInterval(this.timer);\n      this.timer = 0;\n    }\n  },\n  mounted() {\n    this.hd = new HuodeScene();\n    this.addEvents();\n  }\n};\n</script>\n\n<style lang=\"stylus\" scoped>\n@import \"~styles/mixins.styl\"\n.van-popup\n  overflow visible\n  .attendance-wrapper\n    width 585px\n    height 480px\n    border-radius 8px\n    display flex\n    flex-direction column\n    justify-content space-around\n    align-items center\n    overflow visible\n    .attendance-icon\n      line-height 280px\n      text-align center\n      bg-image(\"pop/pop_top_icon\", 280)\n      margin-top -150px\n      baseTextStyle(50px, transparent, $boldFontWeight)\n    .timer\n      color $fff\n    .success\n      active-image(\"pop/success\")\n      color transparent\n    .fail\n      active-image(\"pop/fail\")\n      color transparent\n    .attendance-title\n      baseTextStyle(36px, $c333, $boldFontWeight)\n    .attendance-sub\n      baseTextStyle(30px, $c999)\n    .attendance-btn\n      width 400px\n      height 88px\n      background $red\n      border-radius 44px\n      line-height 88px\n      text-align center\n      baseTextStyle(36px, $fff)\n    .hide\n      visibility hidden\n      opacity 0\n  .attendance-wrapper--result\n    height auto\n</style>\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Attendance.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Attendance.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Attendance.vue?vue&type=template&id=3c4cae56&scoped=true&\"\nimport script from \"./Attendance.vue?vue&type=script&lang=js&\"\nexport * from \"./Attendance.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Attendance.vue?vue&type=style&index=0&id=3c4cae56&lang=stylus&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3c4cae56\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Attendance.vue?vue&type=style&index=0&id=3c4cae56&lang=stylus&scoped=true&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Attendance.vue?vue&type=style&index=0&id=3c4cae56&lang=stylus&scoped=true&\""],"sourceRoot":""}